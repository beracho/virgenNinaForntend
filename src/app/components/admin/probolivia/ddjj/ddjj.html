<div class="container">
  <h2 class="page-title"><i class="fa fa-table"></i> Bandeja <small><strong>de entrada</strong></small></h2>
  <div class="card">
    <div class="card-block">
      <div class="d-flex justify-content-between">
        <div class="btn-container p-2">
          <button class="btn btn-default" md-effect type="button" ng-click="$ctrl.refresh()" uib-tooltip="Actualizar tabla"><i class="fa fa-refresh"></i></button>
        </div>
        <!--        <form name="$ctrl.searchForm" class="form-search p-2" novalidate ng-submit="$ctrl.search()">
                  <div class="input-group">
                    <span class="input-group-btn" ng-if="$ctrl.searchTerm.length">
                      <button class="btn btn-default" type="button" ng-click="$ctrl.cleanSearch()" uib-tooltip="Limpiar búsqueda">
                        <i class="fa fa-trash"></i>
                      </button>
                    </span>
                    <input type="text" class="form-control" placeholder="Escriba su búsqueda aquí" name="searchTerm" ng-model="$ctrl.searchTerm" required />
                    <span class="input-group-btn">
                      <button class="btn btn-default" type="submit" ng-disabled="$ctrl.searchForm.$invalid" uib-tooltip="Buscar en la tabla">
                        <i class="fa fa-search"></i>
                      </button>
                    </span>
                  </div>
                </form>-->
      </div>
      <!--<crud-table buttons="$ctrl.buttons" permission="$ctrl.permission" url="$ctrl.url" edit-modal-controller="$ctrl.editModalController">-->
      <!--</crud-table>-->
      <div class="flex form-group" uib-tooltip="Filtrar datos por departamento, NIT, matrícula, razón social, representante legal o CI">
        <input name="filtro" maxlength="200" class="form-control" ng-model="$ctrl.filtro_bandeja" placeholder="Filtrar datos..." ng-change="$ctrl.changeFilter()">
      </div>
      <div class="table-responsive" ng-table="$ctrl.tableParams" >
        <table class="table table-striped table-hover" >
          <tr ng-repeat="item in $data">
            <td>
              <!--TODO check para firmar que ya esta funcionando, solo ocultamos-->
              <!--<input type="checkbox" ng-checked="item.isRowSelected" ng-click="$ctrl.toggleSelection(item)" ng-show="item.certificacion.estado==='APROBADO'" />-->
            </td>
            <td data-title="'Acciones'" class="accionesSize">
              <div class="accionesSizeDiv">
                <button uib-tooltip="Ver y validar  declaración jurada" md-effect class="btn btn-default"  ng-click="$ctrl.irDetalle(item)"  >
                  <i class="fa fa-eye"></i>
                </button>
                <button uib-tooltip="Ver reporte" md-effect class="btn btn-default"  ng-click="$ctrl.verPdfTabla(item)"  >
                  <i class="fa fa-file-pdf-o"></i>
                </button>
                <button uib-tooltip="Ver certificado" md-effect class="btn btn-default"
                        ng-click="$ctrl.veCertificadoTabla(item)" ng-show="item.certificacion.estado === 'APROBADO'" >
                  <i class="fa fa-file"></i>
                </button>
              </div>

            </td>
            <!--<td data-title="'Organización Productiva'" filter="{ 'organizacion': 'text'}" sortable="'organizacion'">-->
            <td data-title="'Nro.'"> {{(($ctrl.tableParams.page()-1) * $ctrl.tableParams.count()) + ($index+1)}}</td>
            <td data-title="'Departamento'">
              {{ item.unidad_productiva.ubicaciones[0].departamento.descripcion}}
            </td>
            <td data-title="'Grupo'">
              {{ $ctrl.procesar(item.certificacion.formulario.nombre)}}
            </td>
            <td data-title="'Tipo'">
              {{ item.certificacion.tipo}}
            </td>
            <td data-title="'NIT/Matrícula'">
              <span ng-if="item.unidad_productiva.nit || item.unidad_productiva.matricula_comercio">
                {{ item.unidad_productiva.nit}}<br>
                {{ item.unidad_productiva.matricula_comercio}}
              </span>
              <span ng-if="!item.unidad_productiva.nit && !item.unidad_productiva.matricula_comercio">
                <i>No tiene</i>
              </span>
            </td>
            <td data-title="'Organización Productiva'" ng-class="item.unidad_productiva.razon_social.length > 30 ? 'card-overflow' : ''" >
              {{item.unidad_productiva.razon_social}}
            </td>
            <td data-title="'Representante Legal/CI'">
              {{item.unidad_productiva.hist_representantes.nombre_completo}}  {{item.unidad_productiva.hist_representantes.documento_identidad}}
            </td>
            <td data-title="'Fecha de solicitud'" class="text-center" >
              {{ item.certificacion._fecha_envio |  date:'dd/MM/yyyy HH:mm:ss' }}
              <!-- {{ item.certificacion._fecha_envio |  date:'dd/MM/yyyy' }} -->
            </td>

            <td data-title="'Usuario de registro'">
              {{$ctrl.getUsuarioReg(item)}}
              <br/>
              <small>(Rol: <strong>{{item.unidad_productiva.usuario.usuarios_roles[0].rol.descripcion}}</strong>)</small>
            </td>

            <td data-title="'Estado'" >
              <span class="badge
                    {{item.certificacion.estado ==='ENVIADO'? 'badge-primary':
                  (item.certificacion.estado ==='APROBADO'? 'badge-success' : ( item.certificacion.estado ==='PENDIENTE_PAGO'? 'badge-warning' :
                  (item.certificacion.estado ==='OBSERVADO'? 'badge-danger' : ( item.certificacion.estado ==='PAGADO'? 'badge-default' : 'badge-default'))))}}
                    ">
                {{item.certificacion.estado}}
              </span>
            </td>

          </tr>
        </table>
      </div>
    </div>

  </div>

</div>
